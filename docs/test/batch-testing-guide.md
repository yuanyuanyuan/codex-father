# ğŸ§ª åˆ†æ‰¹æµ‹è¯•ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ä¸ºäº†é¿å…å†…å­˜æº¢å‡ºé—®é¢˜ï¼ŒCodex Father v1.7.0 é¡¹ç›®æä¾›äº†æ™ºèƒ½åˆ†æ‰¹æµ‹è¯•è§£å†³æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆå°†å¤§å‹æµ‹è¯•å¥—ä»¶åˆ†è§£ä¸ºå¤šä¸ªå°æ‰¹æ¬¡ï¼ŒæŒ‰å†…å­˜å‹åŠ›å’Œä¼˜å…ˆçº§æ‰§è¡Œï¼Œç¡®ä¿åœ¨å„ç§ç¡¬ä»¶ç¯å¢ƒä¸‹éƒ½èƒ½ç¨³å®šè¿è¡Œæµ‹è¯•ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

- **å†…å­˜ä¼˜åŒ–**: è§£å†³JavaScriptå †å†…å­˜æº¢å‡ºé—®é¢˜
- **æ™ºèƒ½åˆ†æ‰¹**: æ ¹æ®å†…å­˜éœ€æ±‚å’Œæµ‹è¯•å¤æ‚åº¦åŠ¨æ€åˆ†ç»„
- **æ–­ç‚¹ç»­ä¼ **: æ”¯æŒä»å¤±è´¥æ‰¹æ¬¡ç»§ç»­æ‰§è¡Œ
- **å®æ—¶ç›‘æ§**: æä¾›è¯¦ç»†çš„å†…å­˜ä½¿ç”¨å’Œæ‰§è¡Œè¿›åº¦ä¿¡æ¯
- **çµæ´»é…ç½®**: å¯æ ¹æ®ç¡¬ä»¶ç¯å¢ƒè°ƒæ•´æ‰¹æ¬¡ç­–ç•¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ—¥å¸¸å¼€å‘æµ‹è¯•

```bash
# âœ… æ¨èï¼šå¿«é€ŸéªŒè¯åŸºç¡€åŠŸèƒ½
npm run test:quick unit

# åŠŸèƒ½ç‰¹å®šçš„å¿«é€Ÿæµ‹è¯•
npm run test:quick integration   # é›†æˆåŠŸèƒ½éªŒè¯
npm run test:quick contract      # å¥‘çº¦éªŒè¯
npm run test:quick http          # HTTPæ¥å£æµ‹è¯•
npm run test:quick mcp           # MCPåŠŸèƒ½æµ‹è¯•
npm run test:quick e2e           # ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆé«˜å†…å­˜ï¼‰
```

### å®Œæ•´åˆ†æ‰¹æµ‹è¯•æµç¨‹

```bash
# 1. æ¸…ç†æ—§çš„æµ‹è¯•ç»“æœï¼ˆæ¨èï¼‰
npm run test:clean

# 2. æ‰§è¡Œå®Œæ•´çš„åˆ†æ‰¹æµ‹è¯•
npm run test:batch

# 3. åˆå¹¶æµ‹è¯•ç»“æœå’Œè¦†ç›–ç‡æŠ¥å‘Š
npm run test:merge

# 4. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
cat test-results/merged-test-report.json | jq '.summary'
```

### ç¡¬ä»¶ç¯å¢ƒé€‚é…

```bash
# ä½é…ç½®ç¯å¢ƒ (< 8GB RAM)
export NODE_OPTIONS="--max-old-space-size=2048"
npm run test:quick unit

# ä¸­ç­‰é…ç½®ç¯å¢ƒ (8-16GB RAM)
npm run test:batch

# é«˜é…ç½®ç¯å¢ƒ (> 16GB RAM)
NODE_OPTIONS="--max-old-space-size=8192" npm run test:batch
```

## ğŸ“Š æµ‹è¯•ç­–ç•¥è¯¦è§£

### å†…å­˜å‹åŠ›åˆ†çº§

| å‹åŠ›ç­‰çº§ | å†…å­˜èŒƒå›´ | æµ‹è¯•ç±»å‹ | è¿è¡Œç­–ç•¥ | é¢„æœŸæ—¶é—´ |
|----------|----------|----------|----------|----------|
| ğŸŸ¢ **ä½å‹åŠ›** | <2GB | å•å…ƒæµ‹è¯•ã€SchemaéªŒè¯ | ä¸­æ‰¹é‡å¹¶è¡Œ | 2-5åˆ†é’Ÿ |
| ğŸŸ¡ **ä¸­å‹åŠ›** | 2-4GB | HTTPæœåŠ¡å™¨ã€é›†æˆæµ‹è¯• | å°æ‰¹é‡å¹¶è¡Œ | 5-10åˆ†é’Ÿ |
| ğŸ”´ **é«˜å‹åŠ›** | >4GB | E2Eæµ‹è¯•ã€MCPæœåŠ¡å™¨ | å•ç‹¬é¡ºåºæ‰§è¡Œ | 10-15åˆ†é’Ÿ |

### æ™ºèƒ½æ‰¹æ¬¡åˆ’åˆ† (å…±16ä¸ªæ‰¹æ¬¡)

| æ‰¹æ¬¡ | åç§° | åŒ…å«æµ‹è¯• | å†…å­˜éœ€æ±‚ | æ‰§è¡Œæ—¶é—´ | ä¼˜å…ˆçº§ |
|------|------|----------|----------|----------|--------|
| 1 | **core-units** | æ ¸å¿ƒå•å…ƒæµ‹è¯• (TaskRunner, é…ç½®) | ~2GB | 3-5åˆ†é’Ÿ | P0 |
| 2 | **small-units** | å°å‹å•å…ƒæµ‹è¯• (å·¥å…·ç±»ã€Schema) | ~1.5GB | 2-3åˆ†é’Ÿ | P0 |
| 3 | **http-server** | HTTPæœåŠ¡å™¨æµ‹è¯• | ~3GB | 8-10åˆ†é’Ÿ | P1 |
| 4 | **contracts** | åŸºç¡€å¥‘çº¦æµ‹è¯• (JSON-RPC, MCP) | ~2.5GB | 4-6åˆ†é’Ÿ | P1 |
| 5 | **small-contracts** | å°å‹å¥‘çº¦æµ‹è¯• (è®¤è¯ã€ç®¡ç†) | ~2GB | 3-4åˆ†é’Ÿ | P1 |
| 6 | **auth-contracts** | è®¤è¯ç›¸å…³å¥‘çº¦æµ‹è¯• | ~2GB | 3-4åˆ†é’Ÿ | P1 |
| 7 | **medium-integration** | ä¸­å‹é›†æˆæµ‹è¯• (å¤„ç†å™¨ã€æ¡¥æ¥) | ~3GB | 6-8åˆ†é’Ÿ | P1 |
| 8 | **taskrunner-tests** | TaskRunnerä¸“é¡¹æµ‹è¯• | ~4GB | 8-10åˆ†é’Ÿ | P1 |
| 9 | **mcp-server** | MCPæœåŠ¡å™¨æµ‹è¯• | ~4GB | 10-12åˆ†é’Ÿ | P1 |
| 10 | **e2e-http-api** | E2E HTTP APIå®Œæ•´æµç¨‹ | ~6GB | 12-15åˆ†é’Ÿ | P2 |
| 11 | **e2e-concurrency** | E2Eå¹¶å‘å¼•æ“æµ‹è¯• | ~6GB | 12-15åˆ†é’Ÿ | P2 |
| 12 | **e2e-mcp-toolkit** | E2E MCPå·¥å…·åŒ…æµ‹è¯• | ~6GB | 15-18åˆ†é’Ÿ | P2 |
| 13 | **acceptance** | éªŒæ”¶æµ‹è¯• (ç”¨æˆ·åœºæ™¯) | ~3GB | 8-10åˆ†é’Ÿ | P2 |
| 14 | **remaining-integration** | å‰©ä½™é›†æˆåŠŸèƒ½ | ~4GB | 10-12åˆ†é’Ÿ | P2 |
| 15 | **complex-integration** | å¤æ‚é›†æˆæµ‹è¯• (MVPç­‰) | ~5GB | 12-15åˆ†é’Ÿ | P2 |
| 16 | **remaining-contracts** | å‰©ä½™å¥‘çº¦éªŒè¯æµ‹è¯• | ~2GB | 4-5åˆ†é’Ÿ | P2 |

### æ‰¹æ¬¡æ‰§è¡Œç­–ç•¥

1. **ä¼˜å…ˆçº§é©±åŠ¨**: P0æ‰¹æ¬¡ä¼˜å…ˆæ‰§è¡Œï¼Œç¡®ä¿æ ¸å¿ƒåŠŸèƒ½ç¨³å®š
2. **å†…å­˜æ„ŸçŸ¥**: å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨ï¼ŒåŠ¨æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°
3. **å¤±è´¥å¿«é€Ÿè·³è¿‡**: æ‰¹æ¬¡å¤±è´¥æ—¶å¿«é€Ÿè·³åˆ°ä¸‹ä¸€æ‰¹æ¬¡ï¼Œæ”¯æŒåç»­é‡è¯•
4. **æ–­ç‚¹ç»­ä¼ **: ä¿å­˜æ‰§è¡ŒçŠ¶æ€ï¼Œæ”¯æŒä»å¤±è´¥æ‰¹æ¬¡ç»§ç»­æ‰§è¡Œ
5. **èµ„æºæ¸…ç†**: æ¯ä¸ªæ‰¹æ¬¡æ‰§è¡Œåè‡ªåŠ¨æ¸…ç†ä¸´æ—¶èµ„æº

## ğŸ› ï¸ æ ¸å¿ƒè„šæœ¬å·¥å…·

### 1. run-batch-tests.ts - æ™ºèƒ½åˆ†æ‰¹æ‰§è¡Œå™¨

**åŠŸèƒ½ç‰¹ç‚¹**:
- ğŸ§  **æ™ºèƒ½å†…å­˜åˆ†é…**: æ ¹æ®æ–‡ä»¶å¤æ‚åº¦å’Œå†å²è¿è¡Œæ•°æ®åŠ¨æ€åˆ†é…å†…å­˜
- ğŸ“Š **å®æ—¶ç›‘æ§**: æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦ã€å†…å­˜ä½¿ç”¨ã€æˆåŠŸç‡ç­‰å…³é”®æŒ‡æ ‡
- ğŸ’¾ **æ–­ç‚¹ç»­ä¼ **: è‡ªåŠ¨ä¿å­˜æ‰§è¡ŒçŠ¶æ€ï¼Œæ”¯æŒä»å¤±è´¥æ‰¹æ¬¡ç»§ç»­
- ğŸ“‹ **è¯¦ç»†æŠ¥å‘Š**: ç”ŸæˆJSONã€æ–‡æœ¬å’ŒHTMLå¤šæ ¼å¼æµ‹è¯•æŠ¥å‘Š
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: æ™ºèƒ½è·³è¿‡å·²é€šè¿‡çš„æµ‹è¯•ï¼Œä¼˜åŒ–æ‰§è¡Œæ—¶é—´

**æ ¸å¿ƒç®—æ³•**:
```javascript
// å†…å­˜åˆ†é…ç®—æ³•ç¤ºä¾‹
function allocateMemoryForBatch(files) {
  const complexity = files.reduce((sum, file) => sum + file.complexity, 0);
  const baseMemory = 1024; // 1GBåŸºç¡€å†…å­˜
  const complexityMultiplier = complexity * 10; // MB per complexity unit
  return Math.max(baseMemory, baseMemory + complexityMultiplier);
}
```

### 2. quick-test.sh - å¿«é€Ÿæµ‹è¯•å¯åŠ¨å™¨

**åŠŸèƒ½ç‰¹ç‚¹**:
- ğŸ¯ **ç±»å‹ç²¾å‡†**: æŒ‰æµ‹è¯•ç±»å‹ç²¾å‡†é€‰æ‹©æµ‹è¯•å­é›†
- âš¡ **æé€Ÿå¯åŠ¨**: ä¼˜åŒ–å¯åŠ¨æµç¨‹ï¼Œé€‚åˆå¼€å‘é˜¶æ®µå¿«é€ŸéªŒè¯
- ğŸ”§ **å†…å­˜ä¼˜åŒ–**: é’ˆå¯¹ä¸åŒæµ‹è¯•ç±»å‹é¢„è®¾æœ€ä¼˜å†…å­˜é…ç½®
- ğŸ›¡ï¸ **å®‰å…¨ä¿æŠ¤**: æ”¯æŒäº¤äº’å¼ç¡®è®¤ï¼Œé¿å…å±é™©æ“ä½œ
- ğŸ“± **å‹å¥½ç•Œé¢**: å½©è‰²è¾“å‡ºå’Œè¿›åº¦æ¡ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# äº¤äº’å¼é€‰æ‹©æµ‹è¯•ç±»å‹
./scripts/quick-test.sh

# ç›´æ¥æŒ‡å®šç±»å‹
./scripts/quick-test.sh unit
./scripts/quick-test.sh integration
./scripts/quick-test.sh e2e
```

### 3. merge-test-results.ts - æµ‹è¯•ç»“æœåˆå¹¶å™¨

**åŠŸèƒ½ç‰¹ç‚¹**:
- ğŸ“Š **æ™ºèƒ½åˆå¹¶**: è‡ªåŠ¨è¯†åˆ«å’Œåˆå¹¶å„æ‰¹æ¬¡çš„æµ‹è¯•ç»“æœ
- ğŸ“ˆ **è¦†ç›–ç‡æ•´åˆ**: æ•´åˆæ‰€æœ‰æ‰¹æ¬¡çš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œç”Ÿæˆç»Ÿä¸€è§†å›¾
- ğŸ“‹ **å¤šæ ¼å¼è¾“å‡º**: æ”¯æŒJSONã€HTMLã€Markdownç­‰å¤šç§æŠ¥å‘Šæ ¼å¼
- ğŸ“‰ **è¶‹åŠ¿åˆ†æ**: è®¡ç®—æµ‹è¯•é€šè¿‡ç‡è¶‹åŠ¿å’Œæ€§èƒ½æŒ‡æ ‡å˜åŒ–
- ğŸ¯ **è´¨é‡è¯„ä¼°**: æä¾›æµ‹è¯•è´¨é‡è¯„åˆ†å’Œæ”¹è¿›å»ºè®®

**æŠ¥å‘Šç±»å‹**:
- **æ‰§è¡Œæ‘˜è¦**: æ€»ä½“é€šè¿‡ç‡ã€æ‰§è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨
- **è¯¦ç»†æŠ¥å‘Š**: æ¯ä¸ªæ‰¹æ¬¡çš„è¯¦ç»†ç»“æœå’Œé”™è¯¯ä¿¡æ¯
- **è¦†ç›–ç‡æŠ¥å‘Š**: ä»£ç è¦†ç›–ç‡ã€åˆ†æ”¯è¦†ç›–ç‡ã€å‡½æ•°è¦†ç›–ç‡
- **æ€§èƒ½æŠ¥å‘Š**: æµ‹è¯•æ‰§è¡Œæ—¶é—´ã€å†…å­˜å³°å€¼ã€èµ„æºä½¿ç”¨

## ğŸ“‹ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ—¥å¸¸å¼€å‘
```bash
# ä¿®æ”¹äº†é…ç½®ç›¸å…³ä»£ç 
npm run test:quick unit

# ä¿®æ”¹äº†HTTPæ¥å£
npm run test:quick http

# ä¿®æ”¹äº†MCPåŠŸèƒ½
npm run test:quick mcp
```

### åœºæ™¯2: æäº¤å‰éªŒè¯
```bash
# è¿è¡Œå…³é”®æµ‹è¯•æ‰¹æ¬¡
npm run test:batch
npm run test:merge
```

### åœºæ™¯3: CI/CDæµæ°´çº¿
```bash
# æ¸…ç†ç¯å¢ƒ
npm run test:clean

# æ‰§è¡Œå®Œæ•´æµ‹è¯•
npm run test:batch

# ç”ŸæˆæŠ¥å‘Š
npm run test:merge

# æ£€æŸ¥ç»“æœ
cat test-results/merged-test-report.json | jq '.summary.successRate'
```

### åœºæ™¯4: å†…å­˜å—é™ç¯å¢ƒ
```bash
# è¶…ä½å†…å­˜æµ‹è¯• (ä»…åŸºç¡€åŠŸèƒ½)
NODE_OPTIONS="--max-old-space-size=1024" npm run test:quick unit

# ä¸­ç­‰å†…å­˜æµ‹è¯• (æ ¸å¿ƒåŠŸèƒ½)
NODE_OPTIONS="--max-old-space-size=2048" npm run test:quick integration
```

## ğŸ“ˆ æŠ¥å‘Šè§£è¯»

### æ‰¹æ¬¡æ‰§è¡ŒæŠ¥å‘Š
æ¯ä¸ªæ‰¹æ¬¡å®Œæˆåä¼šæ˜¾ç¤ºï¼š
- âœ…/âŒ æ‰¹æ¬¡æ‰§è¡ŒçŠ¶æ€
- ğŸ“Š æµ‹è¯•é€šè¿‡æ•°é‡å’Œæ€»æ•°
- â±ï¸ æ‰§è¡Œæ—¶é—´
- ğŸ’¾ å†…å­˜ä½¿ç”¨æƒ…å†µ

### åˆå¹¶æŠ¥å‘Šæ ¼å¼
```json
{
  "timestamp": "2025-01-XX",
  "summary": {
    "totalBatches": 16,
    "totalTests": 1000,
    "totalPassed": 950,
    "totalFailed": 50,
    "successRate": "95.0%",
    "totalDuration": "1200s"
  },
  "coverage": {
    "lines": {"pct": "85.5"},
    "functions": {"pct": "87.2"},
    "branches": {"pct": "82.1"},
    "statements": {"pct": "86.0"}
  }
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: ä»ç„¶å‡ºç°å†…å­˜æº¢å‡º**
```bash
# å‡å°‘å¹¶å‘çº¿ç¨‹
export NODE_OPTIONS="--max-old-space-size=2048"

# æˆ–è€…è¿è¡Œæ›´å°çš„æ‰¹æ¬¡
npm run test:quick unit
```

**Q: æŸä¸ªæ‰¹æ¬¡å¤±è´¥**
```bash
# å•ç‹¬è¿è¡Œå¤±è´¥çš„æ‰¹æ¬¡
npm run test:quick http  # å‡è®¾HTTPæ‰¹æ¬¡å¤±è´¥

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
cat test-results/batch-test-report.json | jq '.results[] | select(.batch=="http-server")'
```

**Q: è¦†ç›–ç‡æŠ¥å‘Šä¸å®Œæ•´**
```bash
# é‡æ–°åˆå¹¶è¦†ç›–ç‡
npm run test:merge

# æˆ–è€…æŸ¥çœ‹ç‰¹å®šæ‰¹æ¬¡çš„è¦†ç›–ç‡
open coverage/lcov-report/index.html
```

### è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
DEBUG=vitest:* npm run test:batch

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
node --trace-gc scripts/run-batch-tests.ts
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **å¼€å‘é˜¶æ®µ**: ä½¿ç”¨ `npm run test:quick unit` è¿›è¡Œå¿«é€ŸéªŒè¯
2. **åŠŸèƒ½å¼€å‘**: æ ¹æ®åŠŸèƒ½ç±»å‹é€‰æ‹©å¯¹åº”çš„å¿«é€Ÿæµ‹è¯•
3. **æäº¤å‰**: è¿è¡Œ `npm run test:batch` ç¡®ä¿æ•´ä½“è´¨é‡
4. **CI/CD**: ä½¿ç”¨åˆ†æ‰¹æµ‹è¯•é¿å…å†…å­˜é—®é¢˜
5. **å†…å­˜ç›‘æ§**: å…³æ³¨å„æ‰¹æ¬¡çš„å†…å­˜ä½¿ç”¨æƒ…å†µ
6. **æŠ¥å‘Šåˆ†æ**: å®šæœŸæŸ¥çœ‹åˆå¹¶æŠ¥å‘Šï¼Œè¯†åˆ«è¶‹åŠ¿

## ğŸ“ é…ç½®è‡ªå®šä¹‰

å¯ä»¥é€šè¿‡ä¿®æ”¹ `scripts/run-batch-tests.ts` ä¸­çš„æ‰¹æ¬¡å®šä¹‰æ¥è‡ªå®šä¹‰ï¼š
- æ‰¹æ¬¡åŒ…å«çš„æµ‹è¯•æ–‡ä»¶
- å†…å­˜é™åˆ¶å¤§å°
- è¶…æ—¶æ—¶é—´
- æ‰§è¡Œä¼˜å…ˆçº§

## ğŸ”„ è¿ç§»æŒ‡å—

ä»æ—§çš„æµ‹è¯•å‘½ä»¤è¿ç§»ï¼š
```bash
# æ—§çš„ (ä¼šå¯¼è‡´å†…å­˜æº¢å‡º)
npm test --watch
npm run test:coverage

# æ–°çš„ (å†…å­˜å®‰å…¨)
npm run test:quick unit
npm run test:batch && npm run test:merge
```