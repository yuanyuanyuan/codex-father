{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Codex-Father Status Response (v1)",
  "type": "object",
  "additionalProperties": true,
  "properties": {
    "id": { "type": "string" },
    "pid": { "type": ["integer", "null"] },
    "state": {
      "type": "string",
      "enum": ["pending", "running", "done", "failed", "paused"]
    },
    "exit_code": { "type": ["integer", "null"] },
    "classification": { "type": ["string", "null"] },
    "tokens_used": { "type": ["integer", "null"] },
    "effective_sandbox": { "type": ["string", "null"] },
    "effective_network_access": { "type": ["string", "null"] },
    "effective_approval_policy": { "type": ["string", "null"] },
    "sandbox_bypass": { "type": ["boolean", "null"] },
    "cwd": { "type": "string" },
    "created_at": { "type": "string", "format": "date-time" },
    "updated_at": { "type": "string", "format": "date-time" },
    "tag": { "type": ["string", "null"] },
    "log_file": { "type": "string" },
    "meta_glob": { "type": ["string", "null"] },
    "last_message_glob": { "type": ["string", "null"] },
    "args": { "type": ["array", "null"], "items": { "type": "string" } },
    "title": { "type": ["string", "null"] },
    "resumed_from": { "type": ["string", "null"] },

    "progress": {
      "type": ["object", "null"],
      "additionalProperties": false,
      "properties": {
        "current": { "type": "integer", "minimum": 0 },
        "total": { "type": "integer", "minimum": 1 },
        "percentage": { "type": "integer", "minimum": 0, "maximum": 100 },
        "currentTask": { "type": ["string", "null"] },
        "etaSeconds": { "type": ["integer", "null"], "minimum": 0 },
        "etaHuman": { "type": ["string", "null"] },
        "estimatedTimeLeft": { "type": ["string", "null"] }
      },
      "required": ["current", "total", "percentage"]
    },

    "dependencies": {
      "type": ["array", "null"],
      "items": { "type": "string" }
    },
    "priority": { "type": ["integer", "null"] },
    "estimated_time": { "type": ["string", "null"] },

    "resource_usage": {
      "type": ["object", "null"],
      "additionalProperties": true,
      "properties": {
        "tokens": { "type": ["integer", "null"] },
        "tokensUsed": { "type": ["integer", "null"] },
        "apiCalls": { "type": ["integer", "null"] },
        "filesModified": { "type": ["integer", "null"] }
      }
    },

    "checkpoints": {
      "type": "array",
      "items": { "$ref": "./checkpoint.schema.json" },
      "default": []
    },
    "resume_from": { "type": ["integer", "null"], "minimum": 1 }
  },
  "required": ["id", "state", "cwd", "created_at", "updated_at"],
  "examples": [
    {
      "id": "abc-123",
      "state": "running",
      "cwd": "/repo",
      "created_at": "2025-10-13T10:30:00Z",
      "updated_at": "2025-10-13T10:34:20Z",
      "progress": {
        "current": 3,
        "total": 10,
        "percentage": 30,
        "currentTask": "正在重构 components/mvp/SimulateForm.tsx",
        "etaHuman": "4m 20s"
      },
      "resource_usage": {
        "tokens": 45000,
        "apiCalls": 12,
        "filesModified": 2
      },
      "checkpoints": [
        { "step": 1, "status": "completed", "artifact": "types.ts", "timestamp": "2025-10-13T10:31:00Z" }
      ],
      "resume_from": 4
    }
  ]
}

