# CI/CD å‘å¸ƒæŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜é¡¹ç›®çš„CI/CDå‘å¸ƒæµç¨‹ï¼ŒåŒ…æ‹¬ä¸»é¡¹ç›®å’ŒMCPå­åŒ…çš„å‘å¸ƒæœºåˆ¶ã€‚

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®ç°åœ¨ä½¿ç”¨**æ‰‹åŠ¨ç‰ˆæœ¬ç®¡ç†**ï¼Œæ›¿æ¢äº†ä¹‹å‰çš„semantic-releaseè‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†ã€‚æä¾›äº†ä¸¤ä¸ªç‹¬ç«‹çš„å‘å¸ƒæµç¨‹ï¼š

1. **ä¸»é¡¹ç›®å‘å¸ƒ** (`release.yml`) - å‘å¸ƒ `codex-father` ä¸»åŒ…
2. **MCPå­åŒ…å‘å¸ƒ** (`mcp-release.yml`) - å‘å¸ƒ `@starkdev020/codex-father-mcp-server` å­åŒ…

## ğŸš€ ä¸»é¡¹ç›®å‘å¸ƒæµç¨‹

### è§¦å‘æ–¹å¼

#### 1. è‡ªåŠ¨è§¦å‘ï¼ˆæ¨èï¼‰
åˆ›å»ºGitæ ‡ç­¾å¹¶æ¨é€ï¼š
```bash
# åˆ›å»ºæ ‡ç­¾
git tag v1.2.3

# æ¨é€æ ‡ç­¾ï¼ˆè‡ªåŠ¨è§¦å‘å‘å¸ƒï¼‰
git push origin v1.2.3
```

#### 2. æ‰‹åŠ¨è§¦å‘
åœ¨GitHub Actionsé¡µé¢æ‰‹åŠ¨è¿è¡Œ "Main Project Release" å·¥ä½œæµï¼Œå¯ä»¥ï¼š
- æŒ‡å®šç‰ˆæœ¬å·
- å¯ç”¨dry-runæ¨¡å¼è¿›è¡Œæµ‹è¯•

### å‘å¸ƒæµç¨‹

1. **è¾“å…¥éªŒè¯** - éªŒè¯ç‰ˆæœ¬å·æ ¼å¼å’Œå‚æ•°
2. **æ„å»ºæµ‹è¯•** - å®‰è£…ä¾èµ–ã€è¿è¡Œæµ‹è¯•ã€æ„å»ºé¡¹ç›®
3. **ç‰ˆæœ¬æ£€æŸ¥** - ç¡®ä¿ `package.json` ç‰ˆæœ¬ä¸æ ‡ç­¾åŒ¹é…
4. **NPMå‘å¸ƒ** - å‘å¸ƒåˆ°NPMå…¬å…±ä»“åº“
5. **GitHub Release** - åˆ›å»ºGitHubå‘å¸ƒé¡µé¢

### è¾“å‡ºäº§ç‰©

- NPMåŒ…ï¼š`codex-father@ç‰ˆæœ¬å·`
- GitHub Releaseï¼šåŒ…å«å‘å¸ƒè¯´æ˜å’Œä¸‹è½½é“¾æ¥

## ğŸ“¦ MCPå­åŒ…å‘å¸ƒæµç¨‹

### è§¦å‘æ–¹å¼

åªèƒ½é€šè¿‡**æ‰‹åŠ¨è§¦å‘**ï¼Œåœ¨GitHub Actionsé¡µé¢è¿è¡Œ "MCP Manual Release" å·¥ä½œæµã€‚

#### å‘å¸ƒæ¨¡å¼

1. **é¢„æ£€æŸ¥æ¨¡å¼** (`preflight`)
   - ä»…æ‰§è¡Œè´¨é‡æ£€æŸ¥å’Œæ„å»º
   - ä¸æ‰§è¡Œä»»ä½•å‘å¸ƒæ“ä½œ
   - ç”¨äºå¼€å‘é˜¶æ®µéªŒè¯

2. **é¢„æ¼”æ¨¡å¼** (`dry-run`)
   - æ¨¡æ‹Ÿå®Œæ•´å‘å¸ƒæµç¨‹
   - ä¸æ‰§è¡Œå®é™…æ“ä½œ
   - æ˜¾ç¤ºæ‰€æœ‰æ­¥éª¤çš„å‡è®¾ç»“æœ

3. **æœ¬åœ°å‘å¸ƒæ¨¡å¼** (`local`)
   - æ‰§è¡Œå®Œæ•´å‘å¸ƒæµç¨‹
   - å‘å¸ƒåˆ°NPMå’Œåˆ›å»ºGitHub Release
   - éœ€è¦é…ç½® `NPM_TOKEN` å’Œ `GITHUB_TOKEN`

4. **ä»…æ ‡ç­¾æ¨¡å¼** (`tag-only`)
   - ä»…åˆ›å»ºGitæ ‡ç­¾
   - ä¸å‘å¸ƒåˆ°NPM
   - ç”¨äºç‰ˆæœ¬æ ‡è®°å’Œé‡Œç¨‹ç¢‘è®°å½•

### å‘å¸ƒæµç¨‹

1. **è¾“å…¥éªŒè¯** - éªŒè¯ç‰ˆæœ¬å·æ ¼å¼(X.Y.Z)å’Œå‘å¸ƒæ¨¡å¼
2. **é¢„æ£€æŸ¥** - è´¨é‡é—¨ç¦æ£€æŸ¥å’Œæ„å»ºéªŒè¯
3. **æ„å»ºæµ‹è¯•** - æ„å»ºMCPå­åŒ…å¹¶éªŒè¯åŠŸèƒ½
4. **ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥** - æ£€æŸ¥ `package.json` ç‰ˆæœ¬å·
5. **GitçŠ¶æ€éªŒè¯** - æ£€æŸ¥åˆ†æ”¯å’Œå·¥ä½œåŒºçŠ¶æ€
6. **åˆ›å»ºGitæ ‡ç­¾** - åˆ›å»ºæ ¼å¼ä¸º `mcp-vX.Y.Z` çš„æ ‡ç­¾
7. **æ„å»ºNPMåŒ…** - åœ¨MCPå­åŒ…ç›®å½•æ„å»º
8. **å‘å¸ƒåˆ°NPM** - å‘å¸ƒåˆ°NPMå…¬å…±ä»“åº“ï¼ˆétag-onlyæ¨¡å¼ï¼‰
9. **åˆ›å»ºGitHub Release** - åˆ›å»ºGitHubå‘å¸ƒé¡µé¢ï¼ˆédry-runæ¨¡å¼ï¼‰

### è¾“å‡ºäº§ç‰©

- Gitæ ‡ç­¾ï¼š`mcp-vX.Y.Z`
- NPMåŒ…ï¼š`@starkdev020/codex-father-mcp-server@ç‰ˆæœ¬å·`
- GitHub Releaseï¼šåŒ…å«å‘å¸ƒè¯´æ˜

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### å¿…éœ€çš„Secrets

åœ¨GitHubä»“åº“è®¾ç½®ä¸­é…ç½®ä»¥ä¸‹secretsï¼š

#### NPM_TOKEN
- **ç”¨é€”**ï¼šNPMåŒ…å‘å¸ƒè®¤è¯
- **è·å–æ–¹å¼**ï¼šåœ¨[NPMå®˜ç½‘](https://www.npmjs.com/)åˆ›å»ºAccess Token
- **æƒé™**ï¼šéœ€è¦å‘å¸ƒæƒé™

#### GITHUB_TOKEN
- **ç”¨é€”**ï¼šGitHub Releaseåˆ›å»ºå’ŒGitæ“ä½œ
- **é…ç½®**ï¼šGitHub Actionsè‡ªåŠ¨æä¾›ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- **æƒé™**ï¼šéœ€è¦ `contents: write` æƒé™

### é…ç½®æ­¥éª¤

1. è¿›å…¥GitHubä»“åº“è®¾ç½®é¡µé¢
2. ç‚¹å‡» "Secrets and variables" > "Actions"
3. ç‚¹å‡» "New repository secret"
4. æ·»åŠ  `NPM_TOKEN` secret

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ä¸»é¡¹ç›®å‘å¸ƒç¤ºä¾‹

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
npm version 1.2.3

# 2. æ¨é€ä»£ç 
git push origin main

# 3. åˆ›å»ºå¹¶æ¨é€æ ‡ç­¾ï¼ˆè‡ªåŠ¨è§¦å‘å‘å¸ƒï¼‰
git tag v1.2.3
git push origin v1.2.3
```

### MCPå­åŒ…å‘å¸ƒç¤ºä¾‹

#### é¢„æ£€æŸ¥æ¨¡å¼
```bash
# æœ¬åœ°è¿è¡Œé¢„æ£€æŸ¥
npm run release:mcp:preflight
```

#### é¢„æ¼”æ¨¡å¼ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰
åœ¨GitHub Actionsé¡µé¢ï¼š
1. é€‰æ‹© "MCP Manual Release" å·¥ä½œæµ
2. å¡«å†™å‚æ•°ï¼š
   - `version`: `3.2.1`
   - `mode`: `dry-run`
3. ç‚¹å‡» "Run workflow"

#### æœ¬åœ°å‘å¸ƒæ¨¡å¼
åœ¨GitHub Actionsé¡µé¢ï¼š
1. é€‰æ‹© "MCP Manual Release" å·¥ä½œæµ
2. å¡«å†™å‚æ•°ï¼š
   - `version`: `3.2.1`
   - `mode`: `local`
3. ç‚¹å‡» "Run workflow"

#### ä»…åˆ›å»ºæ ‡ç­¾
åœ¨GitHub Actionsé¡µé¢ï¼š
1. é€‰æ‹© "MCP Manual Release" å·¥ä½œæµ
2. å¡«å†™å‚æ•°ï¼š
   - `version`: `3.2.1`
   - `mode`: `tag-only`
3. ç‚¹å‡» "Run workflow"

## ğŸ› ï¸ æœ¬åœ°å‘å¸ƒè„šæœ¬

é¡¹ç›®æä¾›äº†æœ¬åœ°å‘å¸ƒçš„npmè„šæœ¬ï¼š

```bash
# é¢„æ£€æŸ¥
npm run release:mcp:preflight

# é¢„æ¼”æµ‹è¯•
npm run release:mcp:dry-run 3.2.1

# æœ¬åœ°å‘å¸ƒ
npm run release:mcp:local 3.2.1

# ä»…åˆ›å»ºæ ‡ç­¾
npm run release:mcp:tag 3.2.1
```

è¿™äº›è„šæœ¬è°ƒç”¨ `scripts/release-mcp-manual.sh` æ‰§è¡Œå®é™…çš„å‘å¸ƒé€»è¾‘ã€‚

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. NPMè®¤è¯å¤±è´¥
```
é”™è¯¯: æœªç™»å½•NPM
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `NPM_TOKEN` secretæ˜¯å¦æ­£ç¡®é…ç½®
- ç¡®è®¤tokenå…·æœ‰å‘å¸ƒæƒé™

#### 2. ç‰ˆæœ¬å·æ ¼å¼é”™è¯¯
```
é”™è¯¯: ç‰ˆæœ¬å·æ ¼å¼æ— æ•ˆï¼Œè¯·ä½¿ç”¨ X.Y.Z æ ¼å¼
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ç‰ˆæœ¬å·éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬æ ¼å¼
- ä¾‹å¦‚ï¼š`1.2.3`ã€`3.2.1`

#### 3. Gitæ ‡ç­¾å·²å­˜åœ¨
```
è­¦å‘Š: æ ‡ç­¾ mcp-v3.2.1 å·²å­˜åœ¨
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- åˆ é™¤ç°æœ‰æ ‡ç­¾ï¼š`git tag -d mcp-v3.2.1`
- åˆ é™¤è¿œç¨‹æ ‡ç­¾ï¼š`git push origin :refs/tags/mcp-v3.2.1`
- ä½¿ç”¨æ–°ç‰ˆæœ¬å·

#### 4. æ„å»ºå¤±è´¥
```
é”™è¯¯: æ„å»ºæ£€æŸ¥å¤±è´¥
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
- ç¡®ä¿ä¾èµ–é¡¹æ­£ç¡®å®‰è£…
- æŸ¥çœ‹æ„å»ºæ—¥å¿—å®šä½å…·ä½“é—®é¢˜

### è°ƒè¯•æŠ€å·§

#### 1. ä½¿ç”¨é¢„æ£€æŸ¥æ¨¡å¼
åœ¨å‘å¸ƒå‰è¿è¡Œé¢„æ£€æŸ¥ï¼ŒåŠæ—©å‘ç°é—®é¢˜ï¼š
```bash
npm run release:mcp:preflight
```

#### 2. ä½¿ç”¨é¢„æ¼”æ¨¡å¼
åœ¨å®é™…å‘å¸ƒå‰è¿è¡Œé¢„æ¼”ï¼ŒéªŒè¯æµç¨‹ï¼š
```bash
npm run release:mcp:dry-run 3.2.1
```

#### 3. æŸ¥çœ‹å·¥ä½œæµæ—¥å¿—
åœ¨GitHub Actionsé¡µé¢æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ï¼Œå®šä½é—®é¢˜æ ¹æºã€‚

#### 4. æœ¬åœ°æµ‹è¯•
åœ¨æœ¬åœ°ç¯å¢ƒæ‰§è¡Œå‘å¸ƒè„šæœ¬è¿›è¡Œæµ‹è¯•ï¼š
```bash
scripts/release-mcp-manual.sh --version 3.2.1 --dry-run
```

## ğŸ“Š å‘å¸ƒéªŒè¯

### ä¸»é¡¹ç›®éªŒè¯
```bash
# æ£€æŸ¥NPMåŒ…
npm view codex-father

# å®‰è£…æµ‹è¯•
npm install -g codex-father
codex-father --version
```

### MCPå­åŒ…éªŒè¯
```bash
# æ£€æŸ¥NPMåŒ…
npm view @starkdev020/codex-father-mcp-server

# å®‰è£…æµ‹è¯•
npm install -g @starkdev020/codex-father-mcp-server
codex-mcp-server --version

# éªŒè¯Gitæ ‡ç­¾
git tag -l | grep mcp-v
```

## ğŸ”„ å›æ»šæµç¨‹

### ä¸»é¡¹ç›®å›æ»š
```bash
# 1. åˆ é™¤æ ‡ç­¾
git tag -d v1.2.3
git push origin :refs/tags/v1.2.3

# 2. å‘å¸ƒä¿®å¤ç‰ˆæœ¬
npm version 1.2.4
git push origin main
git tag v1.2.4
git push origin v1.2.4
```

### MCPå­åŒ…å›æ»š
```bash
# 1. åˆ é™¤æ ‡ç­¾
git tag -d mcp-v3.2.1
git push origin :refs/tags/mcp-v3.2.1

# 2. å‘å¸ƒä¿®å¤ç‰ˆæœ¬ï¼ˆé€šè¿‡GitHub Actionsï¼‰
# åœ¨MCP Manual Releaseå·¥ä½œæµä¸­å‘å¸ƒæ–°ç‰ˆæœ¬
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [MCPæ‰‹åŠ¨å‘å¸ƒæµç¨‹](../docs/releases/RELEASE_FLOW_MCP.md)
- [ç‰ˆæœ¬è¯´æ˜ç´¢å¼•](../docs/releases/README.md)
- [é¡¹ç›®README](../README.md)
- [å˜æ›´æ—¥å¿—](../CHANGELOG.md)

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å‘å¸ƒå‰éªŒè¯**ï¼šå§‹ç»ˆå…ˆè¿è¡Œé¢„æ£€æŸ¥å’Œé¢„æ¼”æ¨¡å¼
2. **ç‰ˆæœ¬ç®¡ç†**ï¼šéµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ
3. **æ–‡æ¡£æ›´æ–°**ï¼šåŠæ—¶æ›´æ–°ç‰ˆæœ¬è¯´æ˜æ–‡æ¡£
4. **æµ‹è¯•éªŒè¯**ï¼šå‘å¸ƒåç«‹å³éªŒè¯åŒ…çš„å¯å®‰è£…æ€§å’ŒåŸºç¡€åŠŸèƒ½
5. **å¤‡ä»½ç­–ç•¥**ï¼šé‡è¦ç‰ˆæœ¬å‘å¸ƒå‰åšå¥½ä»£ç å’Œæ–‡æ¡£å¤‡ä»½