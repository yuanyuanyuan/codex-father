
> codex-father@5.0.0 test:batch
> tsx scripts/run-batch-tests.ts

ğŸ¯ å¯åŠ¨åˆ†æ‰¹æµ‹è¯•æ‰§è¡Œå™¨
ğŸ’¾ ç³»ç»Ÿå†…å­˜: 32011MB
ğŸ“‹ æµ‹è¯•è®¡åˆ’: 16ä¸ªæ‰¹æ¬¡
â° é¢„è®¡æ€»è€—æ—¶: 133åˆ†é’Ÿ

ğŸ“ è¿›åº¦: 1/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: core-units
ğŸ“ æµ‹è¯•æ–‡ä»¶: 9ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 2048MB
â±ï¸  è¶…æ—¶æ—¶é—´: 300ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/unit/versionDetector.test.ts" "tests/unit/configValidator.test.ts" "tests/unit/configSchema.test.ts" "tests/unit/errorFormatter.test.ts" "tests/unit/degradationStrategy.test.ts" "tests/unit/profileManager.test.ts" "tests/unit/parameterMapping.test.ts" "tests/unit/modelWireApiMapping.test.ts" "tests/unit/bulk-sdk.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ core-units å®Œæˆ
ğŸ“Š ç»“æœ: 9/9 é€šè¿‡ï¼Œè€—æ—¶ 2ç§’

ğŸ“ è¿›åº¦: 2/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: small-units
ğŸ“ æµ‹è¯•æ–‡ä»¶: 5ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 1536MB
â±ï¸  è¶…æ—¶æ—¶é—´: 120ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=1536" npx vitest run "tests/unit/schemas/status-example.test.ts" "tests/unit/schemas/events-enum.test.ts" "tests/unit/http-version.test.ts" "tests/unit/version-command.test.ts" "tests/unit/mcp-tools-spec-version.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ small-units å®Œæˆ
ğŸ“Š ç»“æœ: 5/5 é€šè¿‡ï¼Œè€—æ—¶ 1ç§’

ğŸ“ è¿›åº¦: 3/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: http-server
ğŸ“ æµ‹è¯•æ–‡ä»¶: 1ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 3072MB
â±ï¸  è¶…æ—¶æ—¶é—´: 600ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=3072" npx vitest run "tests/unit/http/HTTPServer.unit.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ http-server å®Œæˆ
ğŸ“Š ç»“æœ: 1/1 é€šè¿‡ï¼Œè€—æ—¶ 1ç§’

ğŸ“ è¿›åº¦: 4/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: contracts
ğŸ“ æµ‹è¯•æ–‡ä»¶: 4ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 2560MB
â±ï¸  è¶…æ—¶æ—¶é—´: 300ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=2560" npx vitest run "tests/contract/codex-jsonrpc.test.ts" "tests/contract/mcp-tools-list.test.ts" "tests/contract/mcp-tools-call.test.ts" "tests/contract/mcp-initialize.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ contracts å®Œæˆ
ğŸ“Š ç»“æœ: 4/4 é€šè¿‡ï¼Œè€—æ—¶ 1ç§’

ğŸ“ è¿›åº¦: 5/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: small-contracts
ğŸ“ æµ‹è¯•æ–‡ä»¶: 7ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 2048MB
â±ï¸  è¶…æ—¶æ—¶é—´: 240ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/sendUserTurn.contract.test.ts" "tests/contract/sendUserMessage.contract.test.ts" "tests/contract/applyPatchApproval.contract.test.ts" "tests/contract/execOneOffCommand.contract.test.ts" "tests/contract/codex-event.contract.test.ts" "tests/contract/listConversations.contract.test.ts" "tests/contract/getUserSavedConfig.contract.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ small-contracts å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/sendUserTurn.contract.test.ts" "tests/contract/sendUserMessage.contract.test.ts" "tests/contract/applyPatchApproval.contract.test.ts" "tests/contract/execOneOffCommand.contract.test.ts" "tests/contract/codex-event.contract.test.ts" "tests/contract/listConversations.contract.test.ts" "tests/contract/getUserSavedConfig.contract.test.ts" --reporter=json --reporter=verbose --no-coverage
â¯â¯â¯â¯â¯â¯ Failed Tests 20 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/contract/codex-event.contract.test.ts > MCP Contract: codex/event > Notification Validation > should validate task_started event with conversation context
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/codex-event.contract.test.ts:21:43
     19|       };
     20| 
     21|       expect(validateNotification(event)).toBe(true);
       |                                           ^
     22|     });
     23| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/20]â¯

 FAIL  tests/contract/codex-event.contract.test.ts > MCP Contract: codex/event > Notification Validation > should validate agent_message event with streaming role information
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/codex-event.contract.test.ts:32:43
     30|       };
     31| 
     32|       expect(validateNotification(event)).toBe(true);
       |                                           ^
     33|     });
     34| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/20]â¯

 FAIL  tests/contract/codex-event.contract.test.ts > MCP Contract: codex/event > Notification Validation > should validate apply_patch_approval_request event with change map
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/codex-event.contract.test.ts:49:43
     47|       };
     48| 
     49|       expect(validateNotification(event)).toBe(true);
       |                                           ^
     50|     });
     51| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/20]â¯

 FAIL  tests/contract/codex-event.contract.test.ts > MCP Contract: codex/event > Notification Validation > should accept events with _meta.requestId for correlation
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/codex-event.contract.test.ts:61:43
     59|       };
     60| 
     61|       expect(validateNotification(event)).toBe(true);
       |                                           ^
     62|     });
     63| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/20]â¯

 FAIL  tests/contract/codex-event.contract.test.ts > MCP Contract: codex/event > Notification Validation > should validate token_count event with usage snapshot
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/codex-event.contract.test.ts:106:43
    104|       };
    105| 
    106|       expect(validateNotification(event)).toBe(true);
       |                                           ^
    107|     });
    108|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/20]â¯

 FAIL  tests/contract/getUserSavedConfig.contract.test.ts > MCP Contract: getUserSavedConfig > Response Validation > æ¥å—åŒ…å«å®Œæ•´é…ç½®é€‰é¡¹çš„å“åº”
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/getUserSavedConfig.contract.test.ts:80:42
     78|       };
     79| 
     80|       expect(validateResponse(response)).toBe(true);
       |                                          ^
     81|     });
     82| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/20]â¯

 FAIL  tests/contract/listConversations.contract.test.ts > MCP Contract: listConversations > Request Validation > should accept request filtering by model and status
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/listConversations.contract.test.ts:38:40
     36|       };
     37| 
     38|       expect(validateRequest(request)).toBe(true);
       |                                        ^
     39|     });
     40| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/20]â¯

 FAIL  tests/contract/listConversations.contract.test.ts > MCP Contract: listConversations > Request Validation > should reject request with invalid status value
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ tests/contract/listConversations.contract.test.ts:46:40
     44|       };
     45| 
     46|       expect(validateRequest(request)).toBe(false);
       |                                        ^
     47|     });
     48| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/20]â¯

 FAIL  tests/contract/listConversations.contract.test.ts > MCP Contract: listConversations > Response Validation > should validate response with empty conversation list
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/listConversations.contract.test.ts:66:42
     64|       };
     65| 
     66|       expect(validateResponse(response)).toBe(true);
       |                                          ^
     67|     });
     68| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/20]â¯

 FAIL  tests/contract/listConversations.contract.test.ts > MCP Contract: listConversations > Response Validation > should validate response with populated conversations
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/listConversations.contract.test.ts:88:42
     86|       };
     87| 
     88|       expect(validateResponse(response)).toBe(true);
       |                                          ^
     89|     });
     90| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/20]â¯

 FAIL  tests/contract/sendUserMessage.contract.test.ts > MCP Contract: sendUserMessage > Request Validation > æ¥å—æ–‡æœ¬æ¶ˆæ¯åˆ—è¡¨
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserMessage.contract.test.ts:23:9
     21|           ],
     22|         })
     23|       ).toBe(true);
       |         ^
     24|     });
     25| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/20]â¯

 FAIL  tests/contract/sendUserMessage.contract.test.ts > MCP Contract: sendUserMessage > Request Validation > æ¥å—æ··åˆæ–‡æœ¬ä¸å›¾ç‰‡çš„æ¶ˆæ¯
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserMessage.contract.test.ts:41:9
     39|           ],
     40|         })
     41|       ).toBe(true);
       |         ^
     42|     });
     43| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/20]â¯

 FAIL  tests/contract/sendUserMessage.contract.test.ts > MCP Contract: sendUserMessage > Response Validation > æ¥å— accepted=true çš„å“åº”
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserMessage.contract.test.ts:115:9
    113|           accepted: true,
    114|         })
    115|       ).toBe(true);
       |         ^
    116|     });
    117| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/20]â¯

 FAIL  tests/contract/sendUserMessage.contract.test.ts > MCP Contract: sendUserMessage > Response Validation > æ¥å— accepted=false çš„å“åº”
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserMessage.contract.test.ts:123:9
    121|           accepted: false,
    122|         })
    123|       ).toBe(true);
       |         ^
    124|     });
    125| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/20]â¯

 FAIL  tests/contract/sendUserTurn.contract.test.ts > MCP Contract: sendUserTurn > Request Validation > æ¥å—æœ€å°åŒ–çš„è¯·æ±‚
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserTurn.contract.test.ts:23:9
     21|           ],
     22|         })
     23|       ).toBe(true);
       |         ^
     24|     });
     25| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/20]â¯

 FAIL  tests/contract/sendUserTurn.contract.test.ts > MCP Contract: sendUserTurn > Request Validation > æ¥å—åŒ…å«å¯é€‰ effort ä¸ summary çš„è¯·æ±‚
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserTurn.contract.test.ts:39:9
     37|           summary: 'auto',
     38|         })
     39|       ).toBe(true);
       |         ^
     40|     });
     41| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/20]â¯

 FAIL  tests/contract/sendUserTurn.contract.test.ts > MCP Contract: sendUserTurn > Response Validation > æ¥å— accepted=true çš„å“åº”
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserTurn.contract.test.ts:107:9
    105|           accepted: true,
    106|         })
    107|       ).toBe(true);
       |         ^
    108|     });
    109| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/20]â¯

 FAIL  tests/contract/sendUserTurn.contract.test.ts > MCP Contract: sendUserTurn > Response Validation > æ¥å— accepted=false çš„å“åº”
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/sendUserTurn.contract.test.ts:115:9
    113|           accepted: false,
    114|         })
    115|       ).toBe(true);
       |         ^
    116|     });
    117| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/20]â¯

 FAIL  tests/contract/sendUserTurn.contract.test.ts > MCP Contract: sendUserTurn > ç‰ˆæœ¬å…¼å®¹æ€§å…ƒæ•°æ® > effort å±æ€§ä¸Šæºå¸¦ minVersion å…ƒæ•°æ®
AssertionError: expected undefined to be '0.44.0' // Object.is equality

- Expected: 
"0.44.0"

+ Received: 
undefined

 â¯ tests/contract/sendUserTurn.contract.test.ts:142:61
    140| 
    141|     it('effort å±æ€§ä¸Šæºå¸¦ minVersion å…ƒæ•°æ®', () => {
    142|       expect(schema.request.properties?.effort?.minVersion).toBe('0.44â€¦
       |                                                             ^
    143|     });
    144| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/20]â¯

 FAIL  tests/contract/sendUserTurn.contract.test.ts > MCP Contract: sendUserTurn > ç‰ˆæœ¬å…¼å®¹æ€§å…ƒæ•°æ® > summary å±æ€§ä¸Šæºå¸¦ minVersion å…ƒæ•°æ®
AssertionError: expected undefined to be '0.44.0' // Object.is equality

- Expected: 
"0.44.0"

+ Received: 
undefined

 â¯ tests/contract/sendUserTurn.contract.test.ts:146:62
    144| 
    145|     it('summary å±æ€§ä¸Šæºå¸¦ minVersion å…ƒæ•°æ®', () => {
    146|       expect(schema.request.properties?.summary?.minVersion).toBe('0.4â€¦
       |                                                              ^
    147|     });
    148|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/20]â¯



ğŸ“ è¿›åº¦: 6/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: auth-contracts
ğŸ“ æµ‹è¯•æ–‡ä»¶: 8ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 2048MB
â±ï¸  è¶…æ—¶æ—¶é—´: 240ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/getAuthStatus.contract.test.ts" "tests/contract/loginChatGpt.test.ts" "tests/contract/loginApiKey.test.ts" "tests/contract/loginChatGptComplete.test.ts" "tests/contract/cancelLoginChatGpt.contract.test.ts" "tests/contract/logoutChatGpt.test.ts" "tests/contract/authStatusChange.contract.test.ts" "tests/contract/userInfo.contract.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ auth-contracts å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/getAuthStatus.contract.test.ts" "tests/contract/loginChatGpt.test.ts" "tests/contract/loginApiKey.test.ts" "tests/contract/loginChatGptComplete.test.ts" "tests/contract/cancelLoginChatGpt.contract.test.ts" "tests/contract/logoutChatGpt.test.ts" "tests/contract/authStatusChange.contract.test.ts" "tests/contract/userInfo.contract.test.ts" --reporter=json --reporter=verbose --no-coverage
â¯â¯â¯â¯â¯â¯â¯ Failed Tests 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/contract/authStatusChange.contract.test.ts > MCP Contract: authStatusChange > Notification Validation > should accept minimal authentication status change
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/authStatusChange.contract.test.ts:16:50
     14|       };
     15| 
     16|       expect(validateNotification(notification)).toBe(true);
       |                                                  ^
     17|     });
     18| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯



ğŸ“ è¿›åº¦: 7/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: medium-integration
ğŸ“ æµ‹è¯•æ–‡ä»¶: 5ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 3072MB
â±ï¸  è¶…æ—¶æ—¶é—´: 400ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=3072" npx vitest run "tests/integration/configHandlers.test.ts" "tests/integration/utilHandlers.test.ts" "tests/integration/bridge-happy-path.test.ts" "tests/integration/eventHandler.test.ts" "tests/integration/approvalHandlers.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ medium-integration å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=3072" npx vitest run "tests/integration/configHandlers.test.ts" "tests/integration/utilHandlers.test.ts" "tests/integration/bridge-happy-path.test.ts" "tests/integration/eventHandler.test.ts" "tests/integration/approvalHandlers.test.ts" --reporter=json --reporter=verbose --no-coverage
â¯â¯â¯â¯â¯â¯â¯ Failed Tests 7 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/approvalHandlers.test.ts > approvalHandlers.applyPatchApproval > åº”è¿”å› allow å†³ç­–å¹¶ç¬¦åˆå“åº”å¥‘çº¦
AssertionError: expected 'allow' to deeply equal { decision: 'allow' }

- Expected: 
Object {
  "decision": "allow",
}

+ Received: 
"allow"

 â¯ tests/integration/approvalHandlers.test.ts:28:24
     26|     expect(res.jsonrpc).toBe('2.0');
     27|     expect(res.id).toBe('req-1');
     28|     expect(res.result).toEqual({ decision: 'allow' });
       |                        ^
     29| 
     30|     // å¥‘çº¦æ ¡éªŒ

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/7]â¯

 FAIL  tests/integration/configHandlers.test.ts > configHandlers.getUserSavedConfig > åº”è¿”å›ç”¨æˆ·ä¿å­˜çš„é…ç½®å¹¶é€šè¿‡å¥‘çº¦æ ¡éªŒ
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/configHandlers.test.ts:50:37
     48|     expect(res.jsonrpc).toBe('2.0');
     49|     expect(res.id).toBe('req-1');
     50|     expect(validateRes(res.result)).toBe(true);
       |                                     ^
     51|   });
     52| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/7]â¯

 FAIL  tests/integration/configHandlers.test.ts > configHandlers.setDefaultModel > åº”æ¥å— model=nullï¼ˆæ¸…é™¤é»˜è®¤æ¨¡å‹ï¼‰
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/configHandlers.test.ts:125:37
    123|       return { success: true, message: 'cleared' };
    124|     });
    125|     expect(validateRes(res.result)).toBe(true);
       |                                     ^
    126|   });
    127| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/7]â¯

 FAIL  tests/integration/eventHandler.test.ts > eventHandler > parseCodexEvent() > åº”è§£æ JSON-RPC Notification å½¢å¼ (Event)
Error: Invalid codex event: type is required and must be a string
 â¯ Module.parseCodexEvent src/mcp/eventHandler.ts:27:11
     25| 
     26|   if (!rawEvent.type || typeof rawEvent.type !== 'string') {
     27|     throw new Error('Invalid codex event: type is required and must beâ€¦
       |           ^
     28|   }
     29| 
 â¯ tests/integration/eventHandler.test.ts:39:22

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/7]â¯

 FAIL  tests/integration/eventHandler.test.ts > eventHandler > parseCodexEvent() > åº”è§£æäº‹ä»¶è´Ÿè½½å¯¹è±¡å½¢å¼ (EventMsg)
AssertionError: expected undefined to be 'c-001' // Object.is equality

- Expected: 
"c-001"

+ Received: 
undefined

 â¯ tests/integration/eventHandler.test.ts:58:29
     56|       const parsed = parseCodexEvent(raw);
     57|       expect(parsed.type).toBe('exec_approval_request');
     58|       expect(parsed.callId).toBe('c-001');
       |                             ^
     59|       expect(parsed.cwd).toBe('/workspace');
     60|       // å¥‘çº¦æ ¡éªŒ

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/7]â¯

 FAIL  tests/integration/eventHandler.test.ts > eventHandler > parseCodexEvent() > åº”å¯¹ç¼ºå°‘å¿…éœ€å­—æ®µçš„äº‹ä»¶æŠ›å‡ºé”™è¯¯
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ tests/integration/eventHandler.test.ts:66:42
     64|     it('åº”å¯¹ç¼ºå°‘å¿…éœ€å­—æ®µçš„äº‹ä»¶æŠ›å‡ºé”™è¯¯', () => {
     65|       const bad = { type: 'agent_message' } as any; // ç¼ºå°‘ message
     66|       expect(() => parseCodexEvent(bad)).toThrowError(/invalid codex eâ€¦
       |                                          ^
     67|     });
     68|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/7]â¯

 FAIL  tests/integration/eventHandler.test.ts > eventHandler > emitMcpNotification() > åº”ç”Ÿæˆå¹¶æ¨é€ codex/event é€šçŸ¥ï¼ŒåŒ…å« _meta.requestId
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/eventHandler.test.ts:92:51
     90| 
     91|       // å¥‘çº¦æ ¡éªŒï¼ˆé€šçŸ¥çš„ params å¿…é¡»ç¬¦åˆ request schemaï¼‰
     92|       expect(validateCodexEvent(captured.params)).toBe(true);
       |                                                   ^
     93|     });
     94|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/7]â¯



ğŸ“ è¿›åº¦: 8/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: taskrunner-tests
ğŸ“ æµ‹è¯•æ–‡ä»¶: 1ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 2048MB
â±ï¸  è¶…æ—¶æ—¶é—´: 300ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/unit/core/TaskRunner.simple.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ taskrunner-tests å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/unit/core/TaskRunner.simple.test.ts" --reporter=json --reporter=verbose --no-coverage
filter:  tests/unit/core/TaskRunner.simple.test.ts
include: core/**/*.{test,spec}.ts, phases/**/*.{test,spec}.ts, tests/**/*.{test,spec}.ts
exclude:  node_modules/**, dist/**, mcp/codex-mcp-server/**, refer-research/**, core/orchestrator/tests/**, **/*.bench.ts
watch exclude:  **/node_modules/**, **/dist/**

No test files found, exiting with code 1


ğŸ“ è¿›åº¦: 9/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: mcp-server
ğŸ“ æµ‹è¯•æ–‡ä»¶: 1ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 4096MB
â±ï¸  è¶…æ—¶æ—¶é—´: 600ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=4096" npx vitest run "tests/unit/mcp/MCPServer.unit.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ mcp-server å®Œæˆ
ğŸ“Š ç»“æœ: 1/1 é€šè¿‡ï¼Œè€—æ—¶ 1ç§’

ğŸ“ è¿›åº¦: 10/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: e2e-http-api
ğŸ“ æµ‹è¯•æ–‡ä»¶: 1ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 6144MB
â±ï¸  è¶…æ—¶æ—¶é—´: 900ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=6144" npx vitest run "tests/e2e/http-api.e2e.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ e2e-http-api å®Œæˆ
ğŸ“Š ç»“æœ: 1/1 é€šè¿‡ï¼Œè€—æ—¶ 2ç§’

ğŸ“ è¿›åº¦: 11/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: e2e-concurrency
ğŸ“ æµ‹è¯•æ–‡ä»¶: 1ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 6144MB
â±ï¸  è¶…æ—¶æ—¶é—´: 900ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=6144" npx vitest run "tests/e2e/concurrency-engine.e2e.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ e2e-concurrency å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=6144" npx vitest run "tests/e2e/concurrency-engine.e2e.test.ts" --reporter=json --reporter=verbose --no-coverage
stderr | tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > ä¾èµ–å…³ç³»ç®¡ç† > åº”è¯¥æ‹’ç»ä¾èµ–å¤±è´¥çš„ä»»åŠ¡
[2025-10-16T21:32:12.171Z] Task failed-dependency failed: Simulated failure

stderr | tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > è¶…æ—¶å’Œé”™è¯¯å¤„ç† > åº”è¯¥å¤„ç†ä»»åŠ¡è¶…æ—¶
[2025-10-16T21:32:15.178Z] Task timeout-task failed: Timeout

stderr | tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > è¶…æ—¶å’Œé”™è¯¯å¤„ç† > åº”è¯¥å¤„ç†ä»»åŠ¡æ‰§è¡Œé”™è¯¯
[2025-10-16T21:32:16.177Z] Task error-task failed: Task execution failed

stderr | tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > è¶…æ—¶å’Œé”™è¯¯å¤„ç† > åº”è¯¥è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
[2025-10-16T21:32:17.179Z] Task detailed-error-task failed: Detailed error message with context

stderr | tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > è¶…æ—¶å’Œé”™è¯¯å¤„ç† > åº”è¯¥æ­£ç¡®é‡Šæ”¾æ§½ä½å³ä½¿ä»»åŠ¡å¤±è´¥
[2025-10-16T21:32:18.181Z] Task failed-task-for-slot failed: Task failed

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 4 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > ä»»åŠ¡ä¼˜å…ˆçº§å’Œé˜Ÿåˆ— > åº”è¯¥æŒ‰ç…§ä¼˜å…ˆçº§è°ƒåº¦ä»»åŠ¡
AssertionError: expected 1 to be less than 0
 â¯ tests/e2e/concurrency-engine.e2e.test.ts:199:33
    197| 
    198|       expect(highPriorityIndex).toBeLessThan(normalPriorityIndex);
    199|       expect(highPriorityIndex).toBeLessThan(lowPriorityIndex);
       |                                 ^
    200|     });
    201| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯

 FAIL  tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > ä¾èµ–å…³ç³»ç®¡ç† > åº”è¯¥æ­£ç¡®å¤„ç†ä»»åŠ¡ä¾èµ–å…³ç³»
Error: Dependency failed: dependency-task
 â¯ TaskRunner.checkDependencies src/core/TaskRunner.ts:116:15
    114|       const depResult = this.storage.getResult(depId);
    115|       if (!depResult || !depResult.success) {
    116|         throw new Error(`Dependency failed: ${depId}`);
       |               ^
    117|       }
    118|     }
 â¯ TaskRunner.run src/core/TaskRunner.ts:34:16
 â¯ tests/e2e/concurrency-engine.e2e.test.ts:270:69

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯

 FAIL  tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > ä¾èµ–å…³ç³»ç®¡ç† > åº”è¯¥æ”¯æŒå¤æ‚çš„ä¾èµ–é“¾
Error: Dependency failed: task-a
 â¯ TaskRunner.checkDependencies src/core/TaskRunner.ts:116:15
    114|       const depResult = this.storage.getResult(depId);
    115|       if (!depResult || !depResult.success) {
    116|         throw new Error(`Dependency failed: ${depId}`);
       |               ^
    117|       }
    118|     }
 â¯ TaskRunner.run src/core/TaskRunner.ts:34:16
 â¯ tests/e2e/concurrency-engine.e2e.test.ts:371:20

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯

 FAIL  tests/e2e/concurrency-engine.e2e.test.ts > Concurrency Engine E2E Tests > è¶…æ—¶å’Œé”™è¯¯å¤„ç† > åº”è¯¥è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
AssertionError: expected 0 to be greater than 0
 â¯ tests/e2e/concurrency-engine.e2e.test.ts:457:32
    455|       expect(result!.startTime).toBeDefined();
    456|       expect(result!.endTime).toBeDefined();
    457|       expect(result!.duration).toBeGreaterThan(0);
       |                                ^
    458|     });
    459| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯



ğŸ“ è¿›åº¦: 12/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: e2e-mcp-toolkit
ğŸ“ æµ‹è¯•æ–‡ä»¶: 1ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 6144MB
â±ï¸  è¶…æ—¶æ—¶é—´: 900ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=6144" npx vitest run "tests/e2e/mcp-toolkit.e2e.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ e2e-mcp-toolkit å®Œæˆ
ğŸ“Š ç»“æœ: 1/1 é€šè¿‡ï¼Œè€—æ—¶ 1ç§’

ğŸ“ è¿›åº¦: 13/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: acceptance
ğŸ“ æµ‹è¯•æ–‡ä»¶: 2ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 3072MB
â±ï¸  è¶…æ—¶æ—¶é—´: 600ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=3072" npx vitest run "tests/acceptance/quickstart-acceptance.test.ts" "tests/acceptance/orchestrate-manual-path.contract.test.ts" --reporter=json --reporter=verbose --no-coverage
âœ… æ‰¹æ¬¡ acceptance å®Œæˆ
ğŸ“Š ç»“æœ: 2/2 é€šè¿‡ï¼Œè€—æ—¶ 2ç§’

ğŸ“ è¿›åº¦: 14/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: remaining-integration
ğŸ“ æµ‹è¯•æ–‡ä»¶: 7ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 4096MB
â±ï¸  è¶…æ—¶æ—¶é—´: 600ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=4096" npx vitest run "tests/integration/basic-features.test.ts" "tests/integration/new-features.test.ts" "tests/integration/conversationHandlers.test.ts" "tests/integration/error-handling.test.ts" "tests/integration/version-detection.test.ts" "tests/integration/mcp-compatibility.test.ts" "tests/integration/authHandlers.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ remaining-integration å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=4096" npx vitest run "tests/integration/basic-features.test.ts" "tests/integration/new-features.test.ts" "tests/integration/conversationHandlers.test.ts" "tests/integration/error-handling.test.ts" "tests/integration/version-detection.test.ts" "tests/integration/mcp-compatibility.test.ts" "tests/integration/authHandlers.test.ts" --reporter=json --reporter=verbose --no-coverage
â¯â¯â¯â¯â¯â¯ Failed Tests 11 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/authHandlers.test.ts > authHandlers.loginChatGpt > åº”è¿”å› loginId ä¸ authUrlï¼Œå¥‘çº¦æ ¡éªŒé€šè¿‡
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/authHandlers.test.ts:114:37
    112|     expect(res.jsonrpc).toBe('2.0');
    113|     expect(res.id).toBe('req-2');
    114|     expect(validateRes(res.result)).toBe(true);
       |                                     ^
    115|   });
    116| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/11]â¯

 FAIL  tests/integration/authHandlers.test.ts > authHandlers.loginChatGpt > å¥‘çº¦ï¼šrequest å…è®¸ä»»æ„é™„åŠ å±æ€§
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/authHandlers.test.ts:148:29
    146|   it('å¥‘çº¦ï¼šrequest å…è®¸ä»»æ„é™„åŠ å±æ€§', () => {
    147|     const validateReq = ajv.compile(requestSchema);
    148|     expect(validateReq({})).toBe(true);
       |                             ^
    149|     expect(validateReq({ a: 1, b: 'x' })).toBe(true);
    150|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/11]â¯

 FAIL  tests/integration/authHandlers.test.ts > authHandlers.loginChatGptComplete (notification) > åº”åˆ›å»ºç¬¦åˆå¥‘çº¦çš„ JSON-RPC é€šçŸ¥
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/authHandlers.test.ts:171:36
    169|     expect(notif.jsonrpc).toBe('2.0');
    170|     expect(notif.method).toBe('loginChatGptComplete');
    171|     expect(validate(notif.params)).toBe(true);
       |                                    ^
    172|   });
    173| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/11]â¯

 FAIL  tests/integration/authHandlers.test.ts > authHandlers.logoutChatGpt > ä¼ å…¥é¢å¤–å‚æ•°åº”è¢«æ‹’ç»
AssertionError: promise resolved "{ jsonrpc: '2.0', id: 5, â€¦(1) }" instead of rejecting

- Expected
+ Received

- [Error: rejected promise]
+ Object {
+   "id": 5,
+   "jsonrpc": "2.0",
+   "result": Object {
+     "success": true,
+   },
+ }

 â¯ tests/integration/authHandlers.test.ts:268:69
    266|       params: { extra: true },
    267|     } as any;
    268|     await expect(handleLogoutChatGpt(bad, () => ({ success: true }))).â€¦
       |                                                                     ^
    269|       /invalid logoutchatgpt request parameters/i
    270|     );

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/11]â¯

 FAIL  tests/integration/authHandlers.test.ts > authHandlers.logoutChatGpt > å¥‘çº¦ï¼šrequest ä¸ºç©ºå¯¹è±¡ä¸”ä¸å…è®¸é™„åŠ å±æ€§
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/authHandlers.test.ts:282:29
    280|   it('å¥‘çº¦ï¼šrequest ä¸ºç©ºå¯¹è±¡ä¸”ä¸å…è®¸é™„åŠ å±æ€§', () => {
    281|     const validateReq = ajv.compile(requestSchema);
    282|     expect(validateReq({})).toBe(true);
       |                             ^
    283|     expect(validateReq({ extra: 'x' })).toBe(false);
    284|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/11]â¯

 FAIL  tests/integration/conversationHandlers.test.ts > conversationHandlers.resumeConversation > åº”è¿”å› success=true ä¸”åŒ…å« conversationIdï¼Œå¹¶é€šè¿‡å¥‘çº¦æ ¡éªŒ
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/conversationHandlers.test.ts:138:42
    136|       conversationId: '0cc175b9-c0f1-49e3-9a78-7e52e2c6f861',
    137|     });
    138|     expect(validateResponse(res.result)).toBe(true);
       |                                          ^
    139|   });
    140| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/11]â¯

 FAIL  tests/integration/conversationHandlers.test.ts > conversationHandlers.listConversations > åº”è¿”å›ä¼šè¯åˆ—è¡¨å¹¶ç¬¦åˆå“åº”å¥‘çº¦
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/conversationHandlers.test.ts:288:42
    286|     expect(res.id).toBe('req-1');
    287|     expect(res.result).toEqual(mockResult);
    288|     expect(validateResponse(res.result)).toBe(true);
       |                                          ^
    289|   });
    290| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/11]â¯

 FAIL  tests/integration/conversationHandlers.test.ts > conversationHandlers.listConversations > åº”åœ¨æ—  params æ—¶æŒ‰ç©ºè¿‡æ»¤å¤„ç†
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/integration/conversationHandlers.test.ts:304:42
    302| 
    303|     expect(res.result).toEqual({ conversations: [] });
    304|     expect(validateResponse(res.result)).toBe(true);
       |                                          ^
    305|   });
    306| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/11]â¯

 FAIL  tests/integration/conversationHandlers.test.ts > conversationHandlers.listConversations > åº”åœ¨å‚æ•°æ— æ•ˆæ—¶æŠ›å‡ºé”™è¯¯
AssertionError: promise resolved "{ jsonrpc: '2.0', id: 'req-bad', â€¦(1) }" instead of rejecting

- Expected
+ Received

- [Error: rejected promise]
+ Object {
+   "id": "req-bad",
+   "jsonrpc": "2.0",
+   "result": Object {
+     "conversations": Array [],
+   },
+ }

 â¯ tests/integration/conversationHandlers.test.ts:330:5
    328|     await expect(
    329|       handleListConversations(badParams, async () => ({ conversations:â€¦
    330|     ).rejects.toThrow(/invalid listconversations request parameters/i);
       |     ^
    331|   });
    332| });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/11]â¯

 FAIL  tests/integration/version-detection.test.ts > T050 ç‰ˆæœ¬æ£€æµ‹ä¸é™çº§é›†æˆæµ‹è¯• > åœºæ™¯ B2: ä½¿ç”¨ 0.44 ç‹¬æœ‰å‚æ•°ï¼ˆprofileï¼‰åº”è¿”å› JSON-RPC -32602 é”™è¯¯
AssertionError: expected 'Invalid params: \'profile\' requires â€¦' to match /in newConversation/

- Expected: 
/in newConversation/

+ Received: 
"Invalid params: 'profile' requires Codex >= 0.44, current version is 0.42.5"

 â¯ tests/integration/version-detection.test.ts:329:38
    327|         expect(String(err?.message)).toMatch(/current.*0\.42\.5/);
    328|         expect(String(err?.message)).toMatch(/>=\s*0\.44/);
    329|         expect(String(err?.message)).toMatch(/in newConversation/);
       |                                      ^
    330|       }
    331|     } finally {

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/11]â¯

 FAIL  tests/integration/version-detection.test.ts > T050 ç‰ˆæœ¬æ£€æµ‹ä¸é™çº§é›†æˆæµ‹è¯• > åœºæ™¯ B3: æ£€æµ‹ 0.44 ç‹¬æœ‰é…ç½®ï¼Œæ˜¾ç¤ºè­¦å‘Šä½†ç»§ç»­å¯åŠ¨
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ tests/integration/version-detection.test.ts:392:83
    390|       expect(lastParams).toBeDefined();
    391|       const cfg = (lastParams && (lastParams as any).config) || {};
    392|       expect(Object.prototype.hasOwnProperty.call(cfg, 'model_reasoninâ€¦
       |                                                                                   ^
    393|       expect(Object.prototype.hasOwnProperty.call(cfg, 'profile')).toBâ€¦
    394| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/11]â¯



ğŸ“ è¿›åº¦: 15/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: complex-integration
ğŸ“ æµ‹è¯•æ–‡ä»¶: 3ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 5120MB
â±ï¸  è¶…æ—¶æ—¶é—´: 700ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=5120" npx vitest run "tests/integration/mvp1-single-process.test.ts" "tests/integration/approval-flow.test.ts" "tests/integration/config-validation.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ complex-integration å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=5120" npx vitest run "tests/integration/mvp1-single-process.test.ts" "tests/integration/approval-flow.test.ts" "tests/integration/config-validation.test.ts" --reporter=json --reporter=verbose --no-coverage
stderr | tests/integration/config-validation.test.ts > T051 é…ç½®éªŒè¯ä¸ä¿®æ­£é›†æˆæµ‹è¯• > åœºæ™¯ C1: æ£€æµ‹ gpt-5-codex + wire_api="chat" é£é™©é…ç½®å¹¶æ˜¾ç¤ºäº¤äº’æç¤º
[BridgeLayer] Background task failed: Cannot access 'config2' before initialization

stderr | tests/integration/config-validation.test.ts > T051 é…ç½®éªŒè¯ä¸ä¿®æ­£é›†æˆæµ‹è¯• > åœºæ™¯ C2: ç”¨æˆ·ç¡®è®¤ Y ååˆ›å»ºä¿®æ­£ Profile å¹¶ä½¿ç”¨ --profile å¯åŠ¨
[BridgeLayer] Background task failed: Cannot access 'config2' before initialization

stderr | tests/integration/config-validation.test.ts > T051 é…ç½®éªŒè¯ä¸ä¿®æ­£é›†æˆæµ‹è¯• > åœºæ™¯ C3: ç”¨æˆ·ç¡®è®¤ N åä¿ç•™åŸé…ç½®å¯åŠ¨ï¼ˆä¸åˆ›å»º Profileï¼‰
[BridgeLayer] Background task failed: Cannot access 'config2' before initialization

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 3 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/config-validation.test.ts > T051 é…ç½®éªŒè¯ä¸ä¿®æ­£é›†æˆæµ‹è¯• > åœºæ™¯ C1: æ£€æµ‹ gpt-5-codex + wire_api="chat" é£é™©é…ç½®å¹¶æ˜¾ç¤ºäº¤äº’æç¤º
Error: Condition not met within timeout
 â¯ waitForCondition tests/integration/config-validation.test.ts:49:9
     47|     await new Promise((r) => setTimeout(r, intervalMs));
     48|   }
     49|   throw new Error('Condition not met within timeout');
       |         ^
     50| }
     51| 
 â¯ tests/integration/config-validation.test.ts:306:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/3]â¯

 FAIL  tests/integration/config-validation.test.ts > T051 é…ç½®éªŒè¯ä¸ä¿®æ­£é›†æˆæµ‹è¯• > åœºæ™¯ C2: ç”¨æˆ·ç¡®è®¤ Y ååˆ›å»ºä¿®æ­£ Profile å¹¶ä½¿ç”¨ --profile å¯åŠ¨
Error: Condition not met within timeout
 â¯ waitForCondition tests/integration/config-validation.test.ts:49:9
     47|     await new Promise((r) => setTimeout(r, intervalMs));
     48|   }
     49|   throw new Error('Condition not met within timeout');
       |         ^
     50| }
     51| 
 â¯ tests/integration/config-validation.test.ts:350:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/3]â¯

 FAIL  tests/integration/config-validation.test.ts > T051 é…ç½®éªŒè¯ä¸ä¿®æ­£é›†æˆæµ‹è¯• > åœºæ™¯ C3: ç”¨æˆ·ç¡®è®¤ N åä¿ç•™åŸé…ç½®å¯åŠ¨ï¼ˆä¸åˆ›å»º Profileï¼‰
Error: Condition not met within timeout
 â¯ waitForCondition tests/integration/config-validation.test.ts:49:9
     47|     await new Promise((r) => setTimeout(r, intervalMs));
     48|   }
     49|   throw new Error('Condition not met within timeout');
       |         ^
     50| }
     51| 
 â¯ tests/integration/config-validation.test.ts:415:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/3]â¯



ğŸ“ è¿›åº¦: 16/16

ğŸš€ å¼€å§‹æ‰§è¡Œæ‰¹æ¬¡: remaining-contracts
ğŸ“ æµ‹è¯•æ–‡ä»¶: 7ä¸ª
ğŸ’¾ å†…å­˜é™åˆ¶: 2048MB
â±ï¸  è¶…æ—¶æ—¶é—´: 300ç§’
ğŸ”§ æ‰§è¡Œå‘½ä»¤: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/execCommandApproval.contract.test.ts" "tests/contract/resumeConversation.contract.test.ts" "tests/contract/gitDiffToRemote.contract.test.ts" "tests/contract/setDefaultModel.contract.test.ts" "tests/contract/interruptConversation.contract.test.ts" "tests/contract/archiveConversation.contract.test.ts" "tests/contract/getUserAgent.contract.test.ts" --reporter=json --reporter=verbose --no-coverage
âŒ æ‰¹æ¬¡ remaining-contracts å¤±è´¥
âš ï¸  é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/execCommandApproval.contract.test.ts" "tests/contract/resumeConversation.contract.test.ts" "tests/contract/gitDiffToRemote.contract.test.ts" "tests/contract/setDefaultModel.contract.test.ts" "tests/contract/interruptConversation.contract.test.ts" "tests/contract/archiveConversation.contract.test.ts" "tests/contract/getUserAgent.contract.test.ts" --reporter=json --reporter=verbose --no-coverage
â¯â¯â¯â¯â¯â¯â¯ Failed Tests 8 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/contract/execCommandApproval.contract.test.ts > MCP Contract: execCommandApproval > Request Validation > should validate minimal command approval request
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/execCommandApproval.contract.test.ts:19:40
     17|       };
     18| 
     19|       expect(validateRequest(request)).toBe(true);
       |                                        ^
     20|     });
     21| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/8]â¯

 FAIL  tests/contract/execCommandApproval.contract.test.ts > MCP Contract: execCommandApproval > Request Validation > should validate request including optional reason
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/execCommandApproval.contract.test.ts:31:40
     29|       };
     30| 
     31|       expect(validateRequest(request)).toBe(true);
       |                                        ^
     32|     });
     33| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/8]â¯

 FAIL  tests/contract/execCommandApproval.contract.test.ts > MCP Contract: execCommandApproval > Response Validation > should validate allow decision
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/execCommandApproval.contract.test.ts:76:42
     74|       };
     75| 
     76|       expect(validateResponse(response)).toBe(true);
       |                                          ^
     77|     });
     78| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/8]â¯

 FAIL  tests/contract/execCommandApproval.contract.test.ts > MCP Contract: execCommandApproval > Response Validation > should validate deny decision with note
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/execCommandApproval.contract.test.ts:85:42
     83|       };
     84| 
     85|       expect(validateResponse(response)).toBe(true);
       |                                          ^
     86|     });
     87| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/8]â¯

 FAIL  tests/contract/interruptConversation.contract.test.ts > MCP Contract: interruptConversation > Response Validation > should validate response with optional message
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/interruptConversation.contract.test.ts:60:42
     58|       };
     59| 
     60|       expect(validateResponse(response)).toBe(true);
       |                                          ^
     61|     });
     62| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/8]â¯

 FAIL  tests/contract/resumeConversation.contract.test.ts > MCP Contract: resumeConversation > Response Validation > should validate success response including conversationId
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/resumeConversation.contract.test.ts:52:42
     50|       };
     51| 
     52|       expect(validateResponse(response)).toBe(true);
       |                                          ^
     53|     });
     54| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/8]â¯

 FAIL  tests/contract/setDefaultModel.contract.test.ts > MCP Contract: setDefaultModel > Request Validation > æ¥å—åŒæ—¶è®¾ç½®æ¨ç†å¼ºåº¦çš„è¯·æ±‚
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/setDefaultModel.contract.test.ts:37:9
     35|           reasoningEffort: 'high',
     36|         })
     37|       ).toBe(true);
       |         ^
     38|     });
     39| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/8]â¯

 FAIL  tests/contract/setDefaultModel.contract.test.ts > MCP Contract: setDefaultModel > Response Validation > æ¥å—åŒ…å« message çš„å“åº”
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ tests/contract/setDefaultModel.contract.test.ts:78:9
     76|           message: 'é»˜è®¤æ¨¡å‹æœªæ‰¾åˆ°',
     77|         })
     78|       ).toBe(true);
       |         ^
     79|     });
     80| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/8]â¯



================================================================================
ğŸ“Š æµ‹è¯•æ‰§è¡Œå®Œæˆ - åˆ†æ‰¹æµ‹è¯•æŠ¥å‘Š
================================================================================

ğŸ“ˆ æ€»ä½“ç»Ÿè®¡:
   æµ‹è¯•æ€»æ•°: 32
   é€šè¿‡æ•°é‡: 24
   å¤±è´¥æ•°é‡: 8
   æˆåŠŸç‡: 75.0%
   æ€»è€—æ—¶: 77s
   æ‰¹æ¬¡æ•°: 16
   æˆåŠŸæ‰¹æ¬¡: 8
   å¤±è´¥æ‰¹æ¬¡: 8

ğŸ“‹ æ‰¹æ¬¡è¯¦æƒ…:
   âœ… core-units: 9/9 (100%) - 2s
   âœ… small-units: 5/5 (100%) - 1s
   âœ… http-server: 1/1 (100%) - 1s
   âœ… contracts: 4/4 (100%) - 1s
   âŒ small-contracts: 0/1 (0%) - 1s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/sendUserTurn...
   âŒ auth-contracts: 0/1 (0%) - 1s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/getAuthStatu...
   âŒ medium-integration: 0/1 (0%) - 2s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=3072" npx vitest run "tests/integration/configHan...
   âŒ taskrunner-tests: 0/1 (0%) - 1s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/unit/core/TaskRunner....
   âœ… mcp-server: 1/1 (100%) - 1s
   âœ… e2e-http-api: 1/1 (100%) - 2s
   âŒ e2e-concurrency: 0/1 (0%) - 50s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=6144" npx vitest run "tests/e2e/concurrency-engin...
   âœ… e2e-mcp-toolkit: 1/1 (100%) - 1s
   âœ… acceptance: 2/2 (100%) - 2s
   âŒ remaining-integration: 0/1 (0%) - 2s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=4096" npx vitest run "tests/integration/basic-fea...
   âŒ complex-integration: 0/1 (0%) - 8s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=5120" npx vitest run "tests/integration/mvp1-sing...
   âŒ remaining-contracts: 0/1 (0%) - 1s
      é”™è¯¯: Command failed: NODE_OPTIONS="--max-old-space-size=2048" npx vitest run "tests/contract/execCommandA...

ğŸ“„ è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜è‡³: test-results/batch-test-report.json
